# 前端 UI 交互测试

前端地址: http://localhost:3000

---

## 前置条件

- 后端运行在 http://localhost:8000
- 前端运行在 http://localhost:3000
- 浏览器打开 http://localhost:3000

---

## 1. 页面加载

### 1.1 首页加载
- **操作**: 打开 http://localhost:3000
- **预期**: 页面正常加载，显示三栏布局（左: 项目树, 中: 编辑器, 右: 设定面板）
- **检查点**:
  - 无白屏或 JS 错误
  - 左侧面板可见
  - 标题 "Novel Creator" 或类似标识可见

---

## 2. 项目树面板（左侧）

### 2.1 创建项目
- **前置**: 通过 API 创建项目（参考 test-api.md 2.1）
- **操作**: 刷新页面
- **预期**: 左侧项目树显示项目名

### 2.2 展开树结构
- **前置**: 已有 项目 → 书 → 章节 → 场景
- **操作**: 点击书籍节点展开
- **预期**: 显示章节列表
- **操作**: 点击章节节点展开
- **预期**: 显示场景列表

### 2.3 选择场景
- **操作**: 点击一个场景节点
- **预期**: 中间编辑器区域加载该场景内容

---

## 3. 场景编辑器（中间）

### 3.1 查看场景内容
- **前置**: 已选中一个有文本的场景
- **预期**: 编辑器显示场景最新版本的文本

### 3.2 编辑并保存
- **操作**: 在编辑器中修改文本
- **操作**: 点击保存按钮
- **预期**: 保存成功，新版本创建
- **验证**: 刷新页面后内容保持

### 3.3 空场景
- **前置**: 选中一个没有文本版本的场景
- **预期**: 编辑器为空，可以开始输入

---

## 4. Bible 面板（右侧）

### 4.1 查看 Bible 字段
- **前置**: 已有项目
- **操作**: 查看右侧 Bible 面板
- **预期**: 显示 9 个默认字段（世界观、主要人物、时代背景等）

### 4.2 编辑字段值
- **操作**: 点击某个字段的编辑区域
- **操作**: 输入 "公元3050年，星际联邦时代"
- **操作**: 点击保存
- **预期**: 字段值更新成功

### 4.3 锁定/解锁字段
- **操作**: 点击字段的锁定按钮（🔒/🔓 图标）
- **预期**: 锁定状态切换
- **验证**: 锁定的字段会在 AI 生成时作为硬约束注入 Context Pack

### 4.4 错误处理
- **操作**: 断开后端后尝试保存
- **预期**: 显示错误提示，不丢失已输入内容

---

## 5. AI 生成面板

> ⚠️ 需要配置有效的 LLM_API_KEY

### 5.1 生成场景卡
- **前置**: 选中一个场景
- **操作**: 点击 "生成场景卡" 按钮
- **预期**:
  - 按钮显示 "生成中..."
  - 数秒后显示场景卡（标题、地点、时间、人物、冲突等）
- **检查点**:
  - 场景卡所有字段非空
  - 如果有锁定的 Bible 字段，内容应与之一致

### 5.2 生成场景正文
- **前置**: 已生成场景卡
- **操作**: 点击 "生成正文" 按钮
- **预期**:
  - 显示 "正在生成中..."
  - 文本逐步流式显示（SSE streaming）
  - 生成完成后文本完整显示
- **检查点**:
  - 文本为中文小说正文格式
  - 长度接近 target_chars

### 5.3 重置
- **操作**: 点击 "重置" 按钮
- **预期**: 场景卡和生成的文本清空，回到初始状态

### 5.4 错误处理
- **操作**: 无 LLM_API_KEY 时点击生成
- **预期**: 显示错误提示，不崩溃

---

## 6. 章节摘要面板

> ⚠️ 需要配置有效的 LLM_API_KEY

### 6.1 查看无摘要状态
- **前置**: 选中一个未完成的章节
- **预期**: 显示 "标记章节完成后将自动生成摘要" 提示

### 6.2 标记完成并生成摘要
- **前置**: 章节至少有一个场景包含文本
- **操作**: 点击 "标记完成并生成摘要"
- **预期**:
  - 按钮显示 "生成中..."
  - 数秒后显示结构化摘要：
    - 叙事总结
    - 关键事件列表
    - 关键词标签（蓝色）
    - 实体标签（绿色）
    - 情节线索列表

### 6.3 已完成章节
- **前置**: 章节已标记完成
- **操作**: 刷新页面
- **预期**: 直接显示已有摘要，不出现 "标记完成" 按钮

---

## 7. 导出面板

### 7.1 Markdown 导出
- **操作**: 点击 "Markdown" 导出按钮
- **预期**:
  - 浏览器触发文件下载
  - 文件名包含书名（如 `第一卷.md`）
  - 内容为 Markdown 格式（`# 书名`, `## 章节名`）

### 7.2 纯文本导出
- **操作**: 点击 "纯文本" 导出按钮
- **预期**:
  - 浏览器触发文件下载
  - 文件名包含书名（如 `第一卷.txt`）
  - 内容为纯文本，无 Markdown 语法

---

## 8. 响应性和无障碍

### 8.1 加载状态
- **检查**: 所有异步操作都有 loading 提示
- **检查**: 按钮在操作期间 disabled

### 8.2 错误状态
- **检查**: API 错误有红色提示框
- **检查**: 错误信息为中文

### 8.3 控制台
- **操作**: 打开浏览器开发者工具 Console
- **检查**: 无 JS 错误、无 React key 警告
